<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin HQ | CampusMind</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background: #050505; color: #e0e0e0; display: flex; margin: 0; }
        .sidebar { width: 260px; background: #000; border-right: 1px solid #d4af37; height: 100vh; position: fixed; }
        .nav-item { padding: 18px 25px; cursor: pointer; color: #888; transition: 0.3s; }
        .nav-item.active { color: #d4af37; background: rgba(212, 175, 55, 0.05); border-left: 4px solid #d4af37; }
        .main { margin-left: 280px; padding: 40px; flex: 1; }
        .card { background: #111; border: 1px solid #222; border-radius: 15px; padding: 30px; margin-bottom: 25px; display: none; }
        .stat-box { flex: 1; background: #1a1a1a; border: 1px solid #d4af37; padding: 20px; border-radius: 12px; text-align: center; }
        .stat-box p { font-size: 2.5rem; color: #d4af37; margin: 10px 0; font-weight: 800; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: white; border-radius: 8px; }
        .btn { background: #d4af37; color: #000; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 12px; text-align: left; border-bottom: 1px solid #222; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2 style="color:#d4af37; text-align:center;">ADMIN HQ</h2>
        <div class="nav-item active" onclick="tab('dash')">Dashboard</div>
        <div class="nav-item" onclick="tab('staff')">Staff Requests</div>
        <div class="nav-item" onclick="tab('pyq')">Upload PYQ</div>
        <div class="nav-item" onclick="tab('docs')">Knowledge Sync</div>
        <div class="nav-item" onclick="location.href='login.html'">Logout</div>
    </div>
    <div class="main">
        <div id="dash" class="card" style="display: block;">
            <div style="display:flex; gap:20px;">
                <div class="stat-box"><h3>Students</h3><p id="s-count">0</p></div>
                <div class="stat-box"><h3>Staff</h3><p id="t-count">0</p></div>
            </div>
        </div>
        <div id="staff" class="card">
            <h2>Pending Approvals</h2>
            <table><thead><tr><th>Name</th><th>School</th><th>Action</th></tr></thead><tbody id="staff-table"></tbody></table>
        </div>
        <div id="pyq" class="card">
            <h2>Upload PYQ</h2>
            <input type="text" id="p-name" placeholder="Subject">
            <input type="text" id="p-code" placeholder="Code">
            <input type="number" id="p-year" placeholder="Year">
            <input type="file" id="p-file">
            <button class="btn" onclick="upload('pyq')">Upload Paper</button>
        </div>
        <div id="docs" class="card">
            <h2>Knowledge Sync</h2>
            <select id="doc-type"><option>Academic Calendar</option><option>Student List</option></select>
            <input type="file" id="gen-file">
            <button class="btn" onclick="upload('doc')">Sync AI</button>
        </div>
    </div>
    <script>
        function tab(t) { document.querySelectorAll('.card').forEach(c=>c.style.display='none'); document.getElementById(t).style.display='block'; if(t==='dash'||t==='staff') load(); }
        async function load() {
            const res = await fetch('http://127.0.0.1:8000/admin/analytics'); const data = await res.json();
            document.getElementById('s-count').innerText = data.total_students; document.getElementById('t-count').innerText = data.total_staff;
            const sRes = await fetch('http://127.0.0.1:8000/admin/pending_staff'); const staff = await sRes.json();
            document.getElementById('staff-table').innerHTML = staff.map(s => `<tr><td>${s.username}</td><td>${s.school}</td><td><button onclick="approve(${s.id})" class="btn" style="width:auto">Approve</button></td></tr>`).join('');
        }
        async function approve(id) { await fetch('http://127.0.0.1:8000/admin/approve_user', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({user_id:id})}); load(); }
        async function upload(type) {
            const fd = new FormData();
            if(type==='pyq') {
                fd.append("subject_name", document.getElementById('p-name').value); fd.append("subject_code", document.getElementById('p-code').value);
                fd.append("year", document.getElementById('p-year').value); fd.append("course", "SOET"); fd.append("file", document.getElementById('p-file').files[0]);
                await fetch('http://127.0.0.1:8000/admin/upload_pyq', {method:'POST', body:fd});
            } else {
                fd.append("doc_type", document.getElementById('doc-type').value); fd.append("file", document.getElementById('gen-file').files[0]);
                await fetch('http://127.0.0.1:8000/admin/upload_doc', {method:'POST', body:fd});
            }
            alert("Success!");
        }
        window.onload = load;
    </script>
</body>
</html>